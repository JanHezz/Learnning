《微服务系列-Nacos跟Eureka对比》首发[牧马人博客](http://www.luckyhe.com/post/83.html)转发请加此提示

微服务系列断更很久了，最近面试被羞辱了。被大佬问到为啥选择`Nacos`时我竟然说不出为啥选择`Nacos`。当我说出因为功能更强大时，面试官又来追问那为啥不选择`Eureka`。我直接被干碎了，所以这次花了点时间认真去对比了下，两个注册中心的一些区别。

## 主人公

本次的主人公是`Nacos`跟`Eureka` 毫无疑问两者在服务治理方面都是非常优秀的一个框架。`Nacos`生态丰富，功能丰富，目前阿里巴巴一直在更新。所以目前越来越多的人将`Nacos`作为了自己公司的服务注册中心。然而`Eureka`在2.0之后开源版本便停止维护，这也是目前国内抛弃掉他的大部分原因。下面我从功能方面对两者进行一个对比

#### 功能对比

**Nacos**

CAP: Nacos默认Ap，非临时实例使用cp。 Eureka只支持Ap



但是测试机发版不影响。这个bug爆肝一天解决了。这个bug不玄学，有正常报错。所以我们对比了配置文件。很快定位到了问题。是`Activityi`正式环境配置文件没有排除

>org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration.class
>这个问题解决完后，我并不知道有人把测试机的配置文件改了，也就是nacos配置中心的文件。


## 后果

解决完这个问题后。以为尘埃落定了。这时候玄学开始了。测试环境网关路由转发到我本机的时候一直报资源不存在的错误。也就是`404`测试机上所有服务都报这个错。后端代码没有任何报错。并且`nacos`的服务中心是能检测到该服务的。

#### 第一步

看到这个问题我第一时间把`gateway`,`nacos`,`auth`都重启一遍。让路由重新加载。这时候测试机之间访问是正常的。唯独之前出现问题的`Activiti`模块的那个服务。转发不过来。也没有任何报错。因为`nacos`中检查到了我本机的服务,这时候我并没有去怀疑我本机的服务其实没有真实启动起来.然后我爆肝一天一夜检查。检查路由，检查数据库，重启服务。重复这样的步骤。搞了一天。毫无进展。

#### 第二步

一天过去了心态小崩，因为正式环境急需发版，但是测试环境起不来。代码都写好了，没法测试。所以第二天我求助于同组的开发叫他们起一下我那个服务。最后的结果2个人可以正常访问,3个人跟我一样的问题。这时候我心里闪过一句`caonima`。啥玩意啊？？？。
然后我认认真对比了一下，同事跟我的本机代码。毫无头绪。我俩除了电脑不同，啥都是一致的。检查了一下网络，我们都是连的公司内网。如果公司人电脑都不行，那么肯定不是我的问题。但是是一半一半。崩溃边缘

#### 第三步

收拾好心情我认真对比了下，成功者跟我自己本机代码的日志。启动大部分都是一样的。但是我本机一直循环打印

```
2020-07-28 18:14:50.407 DEBUG 13064 --- [      Thread-50] o.activiti.engine.impl.db.DbSqlSession   : flush summary: 0 insert, 0 update, 0 delete.
2020-07-28 18:14:50.407 DEBUG 13064 --- [      Thread-50] o.activiti.engine.impl.db.DbSqlSession   : now executing flush...
Closing JDBC Connection [Transaction-aware proxy for target Connection [com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl@5529fd4e]]
```

就是这段鬼代码。我本机一直打印，但是成功启动的人是不会打印。但是我们代码都一样啊，怎么会出现这个问题呢。此处省略一万个caonima...

## 解决方案

Two years later我再去检查了一遍`nacos`配置中心的配置文件。然后我发现竟然有人改了配置文件。然后我仔细对比了一下改动内容。唯一不同的就是加了中文注释。这时候我报着试一试的办法。把中文注释去了。然后项目竟然起来了？？？
沃特么。`nacos`配置文件存在数据库中。我做梦也特么想不到一个中文注释会引起这个问题。这个bug其实应该是编码问题，springboot项目是会存在这个问题。但是普通项目中启动会报错。但是我启动时并无报错，至今查阅了一些资料，也没能解释这个玄学。所以这个锅就给`nacos`背吧。

## 后话

阿里的小伙伴如果看到这个文章，求求你代码多打点日志，然后把这个bug给解决下吧。这个bug告诉我一个道理,如果在英文水平允许的情况下竟然使用英文注释吧。如果你手中有玄学bug可以把文章发给我哦。