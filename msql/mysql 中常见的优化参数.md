
《MySQL  影响MySQL性能的五大配置参数》首发[橙寂博客](http://www.luckyhe.com/post/72.html)转发请加此提示

# 影响MySQL性能的五大配置参数



我们今天主要和大家分享的是对MySQL性能影响关系紧密的五大配置参数，以下就是文章的具体内容描述，希望会给你带来一些帮助。

以下的文章主要是对MySQL性能影响关系紧密的五大配置参数的介绍，我前几天在相关网站看见对MySQL性能影响关系紧密的五大配置参数的资料，觉得挺好，就拿出来供大家分享，望你能有所收获。

## **(一)连接**

连接通常来自Web服务器，下面列出了一些与连接有关的参数，以及该如何设置它们。

1、`max_connections`=2000

这是Web服务器允许的最大连接数，记住每个连接都要使用会话内存(关于会话内存，文章后面有涉及)。

2、`max_packet_allowed`=512M

最大数据包大小，通常等于你需要在一个大块中返回的最大数据集的大小，如果你在使用远程mysqldump，那它的值需要更大。使用了'blob'等大字段也需要去设置这个值的大小

3、`aborted_connects`

检查系统状态的计数器，确定其没有增长，如果数量增长说明客户端连接时遇到了错误。

4、`thread_cache_size`=512

入站连接会在MySQL中创建一个新的线程，因为MySQL中打开和关闭连接都很廉价，速度也快，它就没有象其它数据库，如Oracle那么多持续连接了，但线程预先创建并不会节约时间，这就是为什么要MySQL线程缓存的原因了。

如果在增长请密切注意创建的线程，让你的线程缓存更大，对于2550或100的thread_cache_size，内存占用也不多。

## **(二)查询缓存**

## **(三)临时表**

内存速度是相当快的，因此我们希望所有的排序操作都在内存中进行，我们可以通过调整查询让结果集更小以实现内存排序，或将变量设置得更大。

`tmp_table_size`=1024M

`max_heap_table_size`=512M

无论何时在MySQL中创建临时表，它都会使用这两个变量的最小值作为临界值，除了在磁盘上构建临时表外，还会创建许多会话，这些会话会抢占有 限制的资源，因此最好是调整查询而不是将这些参数设置得更高，同时，需要注意的是有BLOB或TEXT字段类型的表将直接写入磁盘。

## **(四)会话内存**


MySQL中每个会话都有其自己的内存，这个内存就是分配给SQL查询的内存，因此你想让它变得尽可能大以满足需要。但你不得不平衡同一时间数 据库内一致性会话的数量。这里显得有点黑色艺术的是MySQL是按需分配缓存的，因此，你不能只添加它们并乘以会话的数量，这样估算下来比MySQL典型 的使用要大得多。

建议：这个配置一般在程序中做，。当然不是越大越好的，内存设置越大mysql的压力也更大，一切根据业务而定。当然也可以直接在配置文件做。这样做的话就是一个全局变量了。下面是我得出的一些平均值（我比较懒加上业务量不大都是直接在配置文件改的。
）

最佳做法是启动MySQL，连接所有会话，然后继续关注顶级会话的VIRT列，mysqld行的数目通常保持相对稳定，这就是实际的内存 总用量，减去所有的静态MySQL内存区域，就得到了实际的所有会话内存，然后除以会话的数量就得到平均值。


1、`read_buffer_size` =16M

#是MySQL读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区，MySQL会为它分配一段内存缓冲区。read_buffer_size变量控制这一缓冲区的大小。
#如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能

2、`sort_buffer_size`=2M


#是MySQL执行排序使用的缓冲大小。如果想要增加ORDER BY的速度，首先看是否可以让MySQL使用索引而不是额外的排序阶段。
#如果不能，可以尝试增加sort_buffer_size变量的大小。一般来说1-2m即可。按照具体需求设置大小


3、`join_buffer_size`= 2M　　　　　

执行联合查询分配的缓存区大小，一般将其设置为1M-2M大小，业务量大这个值对应的增大就行
4、`read_rnd_buffer_size`=1M

用于排序和order by操作，最好将其设置为1M。

#提高查询速度，如果需要排序大量数据，可适当调高该值。但MySQL会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大。

**(五)慢查询日志**

慢速查询日志是MySQL很有用的一个特性。

1、`log_slow_queries`


MySQL参数中log_slow_queries参数在my.cnf文件中设置它，将其设置为on，默认情况下，MySQL会将文件放到数据目录，文件以“主机名-slow.log”的形式命名，但你在设置这个选项的时候也可以为其指定一个名字。

2、`long_query_time`=1

默认值是10秒，你可以动态设置它，值从1到将其设置为on，如果数据库启动了，默认情况下，日志将关闭。截至5.1.21和安装了 Google补丁的版本，这个选项可以以微秒设置，这是一个了不起的功能，因为一旦你消除了所有查询时间超过1秒的查询，说明调整非常成功，这样可以帮助 你在问题变大之前消除问题SQL。

3、`log_queries_not_using_indexes`

开启这个选项是个不错的主意，它真实地记录了返回所有行的查询。



## **小结**

我们介绍了MySQL参数的五大类设置，平时我们一般都很少碰它们，在进行MySQL性能调优和故障诊断时这些参数还是非常有用的。

MySQL中的缓存查询包括两个解析查询计划，以及返回的数据集，如果基础表数据或结构有变化，将会使查询缓存中的项目无效。

1、`query_cache_min_res_unit`=512K

MySQL参数中query_cache_min_res_unit查询缓存中的块是以这个大小进行分配的，使用下面的公式计算查询缓存的平均大小，根据计算结果设置这个变量，MySQL就会更有效地使用查询缓存，缓存更多的查询，减少内存的浪费。

2、`query_cache_size`=32M

这个参数设置查询缓存的总大小。

#在数据库写入量或是更新量也比较大的系统，该参数不适合分配过大。而且在高并发，写入量大的系统，建义把该功能禁掉。

3、`query_cache_limit`= 1M

这个参数告诉MySQL丢掉大于这个大小的查询，一般大型查询还是比较少见的，如运行一个批处理执行一个大型报表的统计，因此那些大型结果集不应该填满查询缓存。

4, `query_cache_type` = 1
如果设置为0，那么可以说，你的缓存根本就没有用，相当于禁用了。
如果设置为1，将会缓存所有的结果，除非你的select语句使用SQL_NO_CACHE禁用了查询缓存。

如果设置为2，则只缓存在select语句中通过SQL_CACHE指定需要缓存的查询。

```bash
1. qcache hit ratio = qcache_hits / (qcache_hits + com_select)   
```

```bash
1. SQL> show status like ‘qcache%';   
2. SQL> show status like ‘com_%';   
```
```bash
1. average query size = (query_cache_size – qcache_free_memory)/qcache_queries_in_cache   
```

```bash
1. SQL> show variables like ‘query%';   
2. qcache_* status variables you can get with:   
3. SQL> show status like ‘qcache%';   

```
